% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/core_estimation.R
\name{causalAIPCW}
\alias{causalAIPCW}
\title{Causal estimation for semi-competing risks via augmented IPCW (AIPCW)}
\usage{
causalAIPCW(
  data,
  X1 = "X1",
  X2 = "X2",
  delta1 = "delta1",
  delta2 = "delta2",
  treatment = "A",
  covars = "Z",
  estimand = "all",
  tau = NULL,
  time_interest = NULL,
  time1_interest = NULL,
  PS_model = "logit",
  censor_model = "Cox",
  time_model = "Cox",
  c_nodesize = 15,
  c_ntree = 500,
  t_nodesize = 15,
  t_ntree = 500,
  k = 5,
  crossfit = "auto",
  weights = NULL,
  shuffle = T,
  PS_min = 0.1,
  S_min = 0.05,
  add_naive_est = F,
  n_boot = 100,
  boot_raw = F,
  alpha = 0.05,
  seed = NULL,
  add_IPW = F,
  name = NULL,
  CI_raw = F,
  silent = T,
  add_contrast = F,
  parallel = F,
  n_cores = NULL
)
}
\arguments{
\item{data}{A data.frame containing the variables specified by \code{X1}, \code{X2},
\code{delta1}, \code{delta2}, \code{treatment}, and \code{covars}.}

\item{X1, X2}{Character scalars giving the column names for the observed time variables.}

\item{delta1, delta2}{Character scalars giving the column names for event indicators.
\code{delta1 = 1} indicates the non-terminal event is observed at \code{X1}. \code{delta2 = 1}
indicates the terminal event is observed at \code{X2}. Right censoring is inferred from \code{delta2}.}

\item{treatment}{Character scalar giving the column name of the binary treatment indicator.}

\item{covars}{Character vector of baseline covariate column names used in nuisance models.}

\item{estimand}{Character vector specifying which estimand(s) to compute. Must be one or more of
\code{"all"}, \code{"CIF1"}, \code{"CIF2"}, \code{"CIF3"}.}

\item{tau}{Optional numeric truncation time. If supplied and \code{tau < max(X2)}, times larger than
\code{tau} are truncated to \code{tau} and indicators are set to 0 for events beyond \code{tau}.}

\item{time_interest}{Optional numeric vector of time points at which to evaluate estimands. If \code{NULL},
uses all unique observed times from \code{X1} and \code{X2}.}

\item{time1_interest}{Optional numeric vector of time points to condition on the non-terminal process.
Required when \code{estimand} includes \code{"terminal_risk"} (or \code{"all"}).}

\item{PS_model}{Model for the propensity score \eqn{P(A=1 \mid Z)}. Must be one of
\code{"logit"}, \code{"logit.quad"}, \code{"logit.small"}, \code{"RF"}, \code{"gbm"}.}

\item{censor_model}{Model for the censoring distribution used to construct IPC weights. Must be one of
\code{"Cox"}, \code{"Cox.quad"}, \code{"Cox.small"}, \code{"RSF"}, \code{"Spline"}.}

\item{time_model}{Model for event-time nuisance components used for augmentation. Must be one of
\code{"Cox"}, \code{"RSF"}, \code{"Spline"}.}

\item{c_nodesize}{Integer node size for censoring random survival forest (\code{censor_model = "RSF"}).}

\item{c_ntree}{Integer number of trees for censoring random survival forest (\code{censor_model = "RSF"}).}

\item{t_nodesize}{Integer node size for event-time random survival forest (\code{time_model = "RSF"}).}

\item{t_ntree}{Integer number of trees for event-time random survival forest (\code{time_model = "RSF"}).}

\item{k}{Integer number of folds for cross-fitting. Default is \code{5}.}

\item{crossfit}{Cross-fitting control. Default \code{"auto"} enables cross-fitting when at least one nuisance
model is nonparametric / ML (e.g., \code{"RF"}, \code{"gbm"}, \code{"RSF"}, \code{"Spline"}) and may disable it
when all nuisance models are parametric.}

\item{weights}{Optional numeric vector of observation weights (length \code{nrow(data)}). If \code{NULL}, uses
equal weights.}

\item{shuffle}{Logical; if \code{TRUE}, shuffles rows before constructing folds for cross-fitting.}

\item{PS_min}{Numeric lower bound for propensity scores used in weighting (clipping) to stabilize weights.}

\item{S_min}{Numeric lower bound for censoring survival probabilities used in weighting to avoid extreme IPC weights.}

\item{add_naive_est}{Logical; if \code{TRUE}, also computes a naive (unadjusted) estimator via \code{get_naive_est()}
for comparison.}

\item{n_boot}{Integer number of bootstrap replicates for uncertainty quantification. Use \code{0} to skip inference.}

\item{boot_raw}{Logical; if \code{TRUE}, returns raw bootstrap replicates instead of summarized SE/CI.}

\item{alpha}{Significance level for confidence intervals (e.g., \code{0.05} yields 95 percent CIs).}

\item{seed}{Optional integer random seed for reproducibility.}

\item{add_IPW}{Logical; if \code{TRUE}, also computes an IPW-only estimator in addition to AIPCW.}

\item{name}{Optional character name(s) for method labels. If \code{NULL}, defaults to
\code{"causalAIPCW"} (and \code{"IPW"} if \code{add_IPW = TRUE}).}

\item{CI_raw}{Logical; if \code{TRUE}, returns confidence intervals on the original (non-transformed) scale when
transformations are used internally.}

\item{silent}{Logical; if \code{TRUE}, suppresses progress messages.}

\item{add_contrast}{Logical; if \code{TRUE}, additionally reports contrasts between treatment arms as implemented
internally.}

\item{parallel}{Logical; if \code{TRUE}, uses parallel bootstrap via \pkg{future} / \pkg{future.apply}.}

\item{n_cores}{Optional integer number of cores to use when \code{parallel = TRUE}. If \code{NULL},
uses \code{parallel::detectCores()}.}
}
\value{
A list with components:
\describe{
\item{\code{est}}{A data frame of point estimates indexed by \code{time}. Contains one or more \code{est_*} columns
(e.g., \code{est_CIF1}, \code{est_CIF2}, \code{est_CIF3}) depending on \code{estimand}. A \code{method} column may
appear when multiple methods are requested.}
\item{\code{est_se}}{If \code{n_boot > 0}: either summarized SE/CI results (default) or raw bootstrap replicates when
\code{boot_raw = TRUE}. If \code{n_boot = 0}, \code{NULL}.}
\item{\code{nuisance}}{A list of fitted nuisance components (e.g., fitted PS,
censoring, and time models).}
\item{\code{runtime}}{Runtime for obtaining the point estimates.}
\item{\code{call}}{The matched call with defaults filled in.}
}
}
\description{
\code{causalAIPCW()} estimates causal estimands in semi-competing risks settings
with covariate-dependent censoring. The method involves
(i) a treatment model (propensity score), (ii) a censoring model, and
(iii) an event-time model. The function supports parametric/semi-parametric models
(e.g., logistic regression, Cox PH) and machine-learning models (e.g., random forests, GBM,
random survival forests, splines), with optional cross-fitting and bootstrap inference.
The input data are assumed to contain two observed time variables:
\itemize{
\item \code{X1}: observed time for the non-terminal event (e.g., illness),
\item \code{X2}: observed time for the terminal event (e.g., death),
}
with indicators \code{delta1} and \code{delta2}. Treatment assignment is binary (\code{A}),
and baseline covariates are supplied via \code{covars}.
}
\details{
Supported estimands include cumulative incidence functions (CIFs) for key event types:
\itemize{
\item \code{"CIF1"}: risk for the non-terminal event,
\item \code{"CIF2"}: risk for the terminal event without prior non-terminal event,
\item \code{"CIF3"}: risk of the terminal event
conditional on surviving past a specified non-terminal time (requires \code{time1_interest}),
\item \code{"all"}: compute all estimands above.
}

When \code{boot_raw = FALSE}, bootstrap replicates are summarized
via internal helper functions (\code{get_se()} and \code{get_CI()}).
}
\examples{
\dontrun{
## Simulate some data
dat = sim_data(n=200)
## Estimate all three CIFs at a user-specified grid of times
## Use default nuisance models, and do not compute SEs
fit <- causalAIPCW(
  data = dat,
  covars = c("Z1", "Z2"),
  time_interest = seq(0.5, 5, by = 0.5),
  time1_interest = c(0.5, 1),
  n_boot = 0,
  seed = 1
)
fit$est

## Estimate CIF1 and CIF2, bootstrap for SEs and add IPW for comparison
fit2 <- causalAIPCW(
 data = dat,
 covars = c("Z1", "Z2"),
 estimand = c('CIF1', 'CIF2'),
 time_interest = seq(0.5, 5, by = 0.5),
 add_IPW = TRUE,
 n_boot = 200
)
}

}
