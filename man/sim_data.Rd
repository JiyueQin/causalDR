% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulation.R
\name{sim_data}
\alias{sim_data}
\title{Simulate semi-competing risks data with treatment, confounding, and censoring}
\usage{
sim_data(
  n = 500,
  k2 = c(1, 1),
  k3 = c(1, 1),
  alpha = c(0, 1, 1),
  gamma = c(-2.5, 1, 1, 0.5),
  Lambda0_0 = function(t) {
     0.2 * t
 },
  Lambda0_inv_0 = function(a) {
     5 * a
 },
  Lambda0_1 = function(t) {
     0.1 * t^2
 },
  Lambda0_inv_1 = function(a) {
     sqrt(10 * a)
 }
)
}
\arguments{
\item{n}{Integer sample size. Default is \code{500}.}

\item{k2}{Numeric vector of length 2. Scaling ratios \eqn{(\,k_{2,0}, k_{2,1}\,)}
for \eqn{a=0,1}, representing the ratio \eqn{\lambda_{2a}/\lambda_{0a}} used in the
event-time generation.}

\item{k3}{Numeric vector of length 2. Scaling ratios \eqn{(\,k_{3,0}, k_{3,1}\,)}
for \eqn{a=0,1}, representing the ratio \eqn{\lambda_{3a}/\lambda_{0a}} used in the
event-time generation.}

\item{alpha}{Numeric vector of coefficients \eqn{(\alpha_0,\alpha_1,\alpha_2)}
for the propensity score logistic model using design matrix \code{cbind(1, Z1, Z2)}.}

\item{gamma}{Numeric vector of coefficients \eqn{(\gamma_0,\gamma_1,\gamma_2,\gamma_A)}
for the censoring model. Censoring times are generated as \code{rexp(n, rate = exp(eta))}
with \eqn{\eta=(1, Z_1, Z_2, A)^\top \gamma}.}

\item{Lambda0_0}{Function giving the baseline cumulative hazard function \eqn{\Lambda_{0,0}(t)}
for \eqn{A=0}. Must accept a numeric vector \code{t} and return a numeric vector.}

\item{Lambda0_inv_0}{Function giving the inverse \eqn{\Lambda_{0,0}^{-1}(u)} used for
inverse-transform sampling under \eqn{A=0}.}

\item{Lambda0_1}{Function giving the baseline cumulative hazard function \eqn{\Lambda_{0,1}(t)}
for \eqn{A=1}. If \code{NULL}, it is set equal to \code{Lambda0_0}.}

\item{Lambda0_inv_1}{Function giving the inverse \eqn{\Lambda_{0,1}^{-1}(u)} used for
inverse-transform sampling under \eqn{A=1}. If \code{NULL}, it is set equal to
\code{Lambda0_inv_0}.}
}
\value{
A tibble with \code{n} rows and the following columns:
\describe{
\item{\code{id}}{Subject identifier \code{1:n}.}
\item{\code{A}}{Treatment indicator (0/1).}
\item{\code{X1}}{Observed time \eqn{X_1=\min(T_1,T_2,C)}.}
\item{\code{X2}}{Observed time \eqn{X_2=\min(T_2,C)}.}
\item{\code{delta1}}{Indicator \eqn{I(T_1=X_1)} for observing the nonterminal event.}
\item{\code{delta2}}{Indicator \eqn{I(T_2=X_2)} for observing the terminal event.}
\item{\code{Z1, Z2}}{Baseline covariates.}
\item{\code{event_type}}{Event type label derived from \code{delta1} and \code{delta2}.}
}
}
\description{
Generates a simulated dataset with a binary treatment \eqn{A}, baseline covariates
\eqn{Z_1, Z_2}, semi-competing risks event times \eqn{T_1} (nonterminal event, e.g.,
illness) and \eqn{T_2} (terminal event, e.g., death), and right censoring \eqn{C}.
then the observed data are constructed as:
\deqn{X_1 = \min(T_1, T_2, C), \quad X_2 = \min(T_2, C),}
with event indicators \eqn{\delta_1 = I(T_1 = X_1)} and \eqn{\delta_2 = I(T_2 = X_2)}.
}
\details{
Treatment is assigned by a logistic propensity score model
\eqn{\text{logit}\{P(A=1 \mid Z)\} = (1, Z_1, Z_2)^\top \alpha}. Censoring time follows an exponential distribution
with rate \eqn{\exp\{(1, Z_1, Z_2, A)^\top \gamma\}}.

The semi-competing risks structure allows \eqn{T_1=\infty} with positive probability.
Parameters \code{k2} and \code{k3} control multiplicative scaling of hazards relative
to a baseline hazard \eqn{\lambda_0} (specified separately for \eqn{A=0} and \eqn{A=1}).

The returned tibble contains the observed time variables \code{X1} and \code{X2} and
their corresponding indicators \code{delta1} and \code{delta2}. The column \code{event_type}
is a human-readable label for the observed event type:
\itemize{
\item \code{"0.censored before illness or death"}: censored before \eqn{T_1} and \eqn{T_2}
\item \code{"1.illness then censor"}: \eqn{T_1} observed, then censored before \eqn{T_2}
\item \code{"2.death without illness"}: \eqn{T_2} observed before \eqn{T_1}
\item \code{"3.illness then death"}: both \eqn{T_1} and \eqn{T_2} observed with \eqn{T_1 < T_2}
}
}
\examples{
# Simulate data with defaults
dat <- sim_data()
head(dat)

# Change hazard scaling parameters
dat2 <- sim_data(n = 200, k2 = c(1, 2), k3 = c(1, 1.5))

# Use same baseline hazard under A=1 as under A=0, i.e., no treatment effect
dat3 <- sim_data(n = 200, Lambda0_1 = NULL, Lambda0_inv_1 = NULL)
}
